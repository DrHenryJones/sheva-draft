<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    {% if start or next %}
    <meta http-equiv="refresh" content="8">
    {% endif %}

    <link href="{{url_for('static', filename='style.css')}}" rel="stylesheet" />

    <style type="text/css">

        .navbar-brand small {
            display:block;
            font-size:12px;
        }

        .navbar-toggle {top:10px}

        @media (min-width:768px) {
        
        .navbar-brand {
            padding-top:20px;
        }
        
        .nav.navbar-nav a {
            padding-top:30px;
            padding-bottom:30px;
        }

        }
    </style>

    <title>SHEVA | A System for Hypothesis Exploration with Visual Analytics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
  </head>
  <body>
    <nav class="navbar navbar-light bg-light">
        <div class="container-fluid">
          <a class="navbar-brand">
            SHEVA
            <small>A System for Hypothesis Exploration with Visual Analytics</small>
          </a>
          
          <form class="d-flex" method="POST">
              <select class="form-select me-2 w-100" aria-label="Default select example">
                <option selected value="1">MovieLens</option>
              </select>
                <select class="form-select me-2 w-100" aria-label="Default select example">
                    <option selected value="1">Power Only</option>
                    <option value="2">Coverage Only</option>
                  </select>
                  {% if not start %} <button class="btn btn-outline-success me-2" type="submit" name="action" value="start">Start</button> {% else %} <button class="btn btn-outline-warning me-2" type="submit" name="action" value="stop">Stop</button> {% endif %}
                  {% if not start %} <button class="btn btn-outline-secondary me-2" type="submit" name="action" value="next">Next</button>  {% else %} <button class="btn btn-outline-secondary me-2 disabled" type="submit" name="action" value="next">Next</button>  {% endif %}
            <button class="btn btn-outline-danger" type="submit" name="action" value="reset">Reset</button>
          </form>
        </div>
      </nav>

    
    {% if next %}
    <div class="container px-2 py-3">
      <center>
        <div class="spinner-border text-primary" role="status">
        </div>
      </center>
    </div>
    {% endif %}

      <div class="container px-2 py-3" id="featured-3">

        <div class="row">
            <div class="col-sm">
                <h3 class="pb-2 border-bottom">Current Pipeline</h3>
                <div class="list-group">
                      {% if has_current_hypothesis %}
                      <a href="#" class="list-group-item list-group-item-action d-flex gap-3 py-3 active" aria-current="true">
                        {% if current_hypothesis['action'] == 'Exploit' %}
                        <img src="{{url_for('static', filename='2.png')}}" alt="twbs" width="32" height="32" class="rounded-circle flex-shrink-0">
                        {% else %}
                        <img src="{{url_for('static', filename='3.png')}}" alt="twbs" width="32" height="32" class="rounded-circle flex-shrink-0">
                        {% endif %}
                        
                        <div class="d-flex gap-2 w-100 justify-content-between">
                          <div>
                            <h6 class="mb-0">{{ current_hypothesis['name'] }}</h6>
                            <p class="mb-0 opacity-75">{{ current_hypothesis['user_count'] }} {% if current_hypothesis['user_count'] != 1 %} users {% else %} user {% endif %}, {{ current_hypothesis['movie_count'] }} {% if current_hypothesis['movie_count'] != 1 %} movies {% else %} movie {% endif %}</p>
                            <p class="mb-0 opacity-75">FDR: {{ current_hypothesis['fdr'] }} | Power: {{ current_hypothesis['power'] }} | Coverage: {{ current_hypothesis['coverage'] }}</p>
                              
                          </div>
                          <small class="opacity-50 text-nowrap">{{ current_hypothesis['size_output_set'] }} output {% if current_hypothesis['size_output_set'] != 1 %} regions {% else %} region {% endif %}</small>
                        </div>
                      </a>
                      {% endif %}
                      {% for hypo in current_pipeline %}
                      <a href="#" class="list-group-item list-group-item-action d-flex gap-3 py-3" aria-current="true">
                        {% if hypo['action'] == 'Exploit' %}
                        <img src="{{url_for('static', filename='2.png')}}" alt="twbs" width="32" height="32" class="rounded-circle flex-shrink-0">
                        {% else %}
                        <img src="{{url_for('static', filename='3.png')}}" alt="twbs" width="32" height="32" class="rounded-circle flex-shrink-0">
                        {% endif %}
                        <div class="d-flex gap-2 w-100 justify-content-between">
                          <div>
                            <h6 class="mb-0">{{ hypo['name'] }}</h6>
                            <p class="mb-0 opacity-75">{{ hypo['user_count'] }} {% if hypo['user_count'] != 1 %} users {% else %} user {% endif %}, {{ hypo['movie_count'] }} {% if hypo['movie_count'] != 1 %} movies {% else %} movie {% endif %}</p>
                            <p class="mb-0 opacity-75">FDR: {{ hypo['fdr'] }} | Power: {{ hypo['power'] }} | Coverage: {{ hypo['coverage'] }}</p>
                              
                          </div>
                          <small class="opacity-50 text-nowrap">{{ hypo['size_output_set'] }} output {% if hypo['size_output_set'] != 1 %} regions {% else %} region {% endif %}</small>
                        </div>
                      </a>
                      {% endfor %}

                      <!--
                      <a href="#" class="list-group-item list-group-item-action d-flex gap-3 py-3 active" aria-current="true">
                        <img src="{{url_for('static', filename='2.png')}}" alt="twbs" width="32" height="32" class="rounded-circle flex-shrink-0">
                        <div class="d-flex gap-2 w-100 justify-content-between">
                          <div>
                            <h6 class="mb-0">Students whose rating average is greater than 3.5</h6>
                            <p class="mb-0 opacity-75">1250 users, 23 movies</p>
                            <p class="mb-0 opacity-75">Significance: 0.3 | Power: 0.4 | Coverage: 0.7</p>
                              
                          </div>
                          <small class="opacity-50 text-nowrap">2 output regions</small>
                        </div>
                      </a>
                      <a href="#" class="list-group-item list-group-item-action d-flex gap-3 py-3" aria-current="true">
                        <img src="{{url_for('static', filename='2.png')}}" alt="twbs" width="32" height="32" class="rounded-circle flex-shrink-0">
                        <div class="d-flex gap-2 w-100 justify-content-between">
                          <div>
                            <h6 class="mb-0">Doctors whose rating average is greater than 3.5</h6>
                            <p class="mb-0 opacity-75">650 users, 10 movies</p>
                            <p class="mb-0 opacity-75">Significance: 0.3 | Power: 0.4 | Coverage: 0.7</p>
                          </div>
                          <small class="opacity-50 text-nowrap">0 output regions</small>
                        </div>
                      </a>
                      <a href="#" class="list-group-item list-group-item-action d-flex gap-3 py-3" aria-current="true">
                        <img src="{{url_for('static', filename='3.png')}}" alt="twbs" width="32" height="32" class="rounded-circle flex-shrink-0">
                        <div class="d-flex gap-2 w-100 justify-content-between">
                          <div>
                            <h6 class="mb-0">Engineers whose rating average is greater than 3.5</h6>
                            <p class="mb-0 opacity-75">2000 users, 156 movies</p>
                            <p class="mb-0 opacity-75">Significance: 0.3 | Power: 0.4 | Coverage: 0.7</p>
                          </div>
                          <small class="opacity-50 text-nowrap">1 output region</small>
                        </div>
                      </a>
                      -->

                    </div>
            </div>
            <div class="col-sm">
                <h3 class="pb-2 border-bottom">Current Operator Results</h3>
                <div>
                
                  <div class="accordion h-100 overflow-auto" id="accordionExample">
                  {% if has_current_hypothesis %}
                    {% for region in current_regions %}
                    <div class="accordion-item overflow-auto">
                      <h2 class="accordion-header" id="{{ region['heading_id'] }}">
                        <button class="accordion-button {% if selected_region != region['heading_id'] %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#{{ region['collapse_id'] }}" aria-expanded="{% if selected_region == region['heading_id'] %}true{% else %}false{% endif %}" aria-controls="{{ region['collapse_id'] }}">
                          {% if region['heading_id'] == 'Region0' %}INPUT DATA REGION<br>{% endif %}
                          {{ region['name'] }}
                        </button>
                      </h2>
                      <div id="{{ region['collapse_id'] }}" class="accordion-collapse collapse {% if selected_region == region['heading_id'] %}show{% endif %}" aria-labelledby="{{ region['heading_id'] }}" data-bs-parent="#accordionExample">
                        <div class="accordion-body overflow-auto">

                          {% if region['heading_id'] != 'Region0' %}
                          <p>Change hypothesis</p>
                          <form class="row" method="POST">
                            
                            <div class="col-sm-8">

                              {% if selected_region == region['heading_id'] %}
                              <select class="form-select"  name="Select{{ region['heading_id'] }}" disabled>
                                <option {% if selected_value == '1' %}selected{% endif %} value="1">Rating mean is greater than 2.5</option>
                                <option {% if selected_value == '2' %}selected{% endif %} value="2">Rating variance is greater than 2.5</option>
                                <option {% if selected_value == '3' %}selected{% endif %} value="3">Ratings do not follow normal distribution</option>
                                <option {% if selected_value == '4' %}selected{% endif %} value="4">Any</option>
                              </select>
                              {% else %}
                              <select class="form-select"  name="Select{{ region['heading_id'] }}">
                                <option {% if region['selected_hypothesis'] == 1 %}selected{% endif %} value="1">Rating mean is greater than 2.5</option>
                                <option {% if region['selected_hypothesis'] == 2 %}selected{% endif %} value="2">Rating variance is greater than 2.5</option>
                                <option {% if region['selected_hypothesis'] == 3 %}selected{% endif %} value="3">Ratings do not follow normal distribution</option>
                                <option value="4">Any</option>
                              </select>
                              {% endif %}


                            </div>

                            <div class="col-sm-4">
                              {% if selected_region == region['heading_id'] %}
                              <button class="btn btn-outline-secondary me-2" type="submit" name="action" value="Unselecting{{ region['heading_id'] }}">Unselect</button>
                              {% else %}
                              <button class="btn btn-outline-primary me-2" type="submit" name="action" value="Selecting{{ region['heading_id'] }}">Select</button>
                              {% endif %}
                              
                            </div>
                          </form>
                          <br>

                          <hr/>
                          {% endif %}

                          <!-- Ratings -->

                          <div>
                            <canvas id="{{ region['heading_id'] }}RatingsChart"></canvas>
                          </div>
                          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                          <script>
                          
                            new Chart(document.getElementById("{{ region['heading_id'] }}RatingsChart"), {
                              type: 'bar',
                              data: {
                              labels: ['1', '2', '3', '4', '5'],
                              datasets: [{
                                label: 'Rating count',
                                backgroundColor: ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd'],
                                data: {{ region['rating_count'] }},
                                borderWidth: 1
                              }]
                            },
                              options: {
                                plugins: {
                                legend: { display: false },
                                title: {
                                  display: true,
                                  text: 'Ratings'
                                },
                                scales: {
                                  y: {
                                    beginAtZero: true
                                  },
                                }
                              }
                              }
                            });
                          </script>

                          <!-- Genders -->

                          <div>
                            <canvas id="{{ region['heading_id'] }}GendersChart"></canvas>
                          </div>
                          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                          
                          <script>
                          
                            new Chart(document.getElementById("{{ region['heading_id'] }}GendersChart"), {
                              type: 'bar',
                              data: {
                              labels: ['Male', 'Female'],
                              datasets: [{
                                label: 'User count',
                                backgroundColor: ['#1f77b4', '#ff7f0e'],
                                data: {{ region['genders'] }},
                                borderWidth: 1
                              }]
                            },
                              options: {
                                plugins: {
                                legend: { display: false },
                                title: {
                                  display: true,
                                  text: 'Genders'
                                },
                                scales: {
                                  y: {
                                    beginAtZero: true
                                  },
                                }
                              }
                              }
                            });
                          </script>

                          <!-- Ages -->

                          <div>
                            <canvas id="{{ region['heading_id'] }}AgesChart"></canvas>
                          </div>
                          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                          
                          <script>
                          
                            new Chart(document.getElementById("{{ region['heading_id'] }}AgesChart"), {
                              type: 'bar',
                              data: {
                              labels: ["<18", "18-24", "25-34", "35-44", "45-49", "50-55", ">56"],
                              datasets: [{
                                label: 'User count',
                                backgroundColor: ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b', '#e377c2'],
                                data: {{ region['ages'] }},
                                borderWidth: 1
                              }]
                            },
                              options: {
                                plugins: {
                                legend: { display: false },
                                title: {
                                  display: true,
                                  text: 'Ages'
                                },
                                scales: {
                                  y: {
                                    beginAtZero: true
                                  },
                                }
                              }
                              }
                            });
                          </script>

                          <!-- Occupations -->

                          <div>
                            <canvas id="{{ region['heading_id'] }}OccupationsChart"></canvas>
                          </div>
                          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

                          <script>

                            new Chart(document.getElementById("{{ region['heading_id'] }}OccupationsChart"), {
                              type: 'bar',
                              data: {
                              labels: ['Academic-educator', 'Artist', 'Clerical-admin', 'College-grad student', 'Customer service', 'Doctor-health care', 'Executive-managerial', 'Farmer', 'Homemaker', 'K-12 student', 'Lawyer', 'Programmer', 'Retired', 'Sales-marketing', 'Scientist', 'Self-employed', 'Technician-engineer', 'Tradesman-craftsman', 'Unemployed', 'Writer', 'Other'],
                              datasets: [{
                                label: 'User count',
                                backgroundColor: ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b', '#e377c2', '#7f7f7f', '#bcbd22', '#17becf', '#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b', '#e377c2', '#7f7f7f', '#bcbd22', '#17becf', '#1f77b4'],
                                data: {{ region['occupations'] }},
                                borderWidth: 1
                              }]
                            },
                              options: {
                                plugins: {
                                legend: { display: false },
                                title: {
                                  display: true,
                                  text: 'Occupations'
                                },
                                scales: {
                                  y: {
                                    beginAtZero: true
                                  },
                                }
                              }
                              }
                            });
                          </script>

                          <!-- Genres -->

                          <div>
                            <canvas id="{{ region['heading_id'] }}GenresChart"></canvas>
                          </div>
                          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

                          <script>

                            new Chart(document.getElementById("{{ region['heading_id'] }}GenresChart"), {
                              type: 'bar',
                              data: {
                              labels: ['Action', 'Adventure', 'Animation', "Children's", 'Comedy', 'Crime', 'Documentary', 'Drama', 'Fantasy', 'Film-Noir', 'Horror', 'Musical', 'Mystery', 'Romance', 'Sci-Fi', 'Thriller', 'War', 'Western'],
                              datasets: [{
                                label: 'User count',
                                backgroundColor: ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b', '#e377c2', '#7f7f7f', '#bcbd22', '#17becf', '#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b', '#e377c2', '#7f7f7f'],
                                data: {{ region['genres'] }},
                                borderWidth: 1
                              }]
                            },
                              options: {
                                plugins: {
                                legend: { display: false },
                                title: {
                                  display: true,
                                  text: 'Genres'
                                },
                                scales: {
                                  y: {
                                    beginAtZero: true
                                  },
                                }
                              }
                              }
                            });
                          </script>


                        </div>
                      </div>
                    </div>
                    {% endfor %}
                    {% endif %}

                  


                  <!--
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                          Students whose rating average is greater than 3.5
                        </button>
                      </h2>
                      <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                            <div>
                                <canvas id="myChart"></canvas>
                              </div>
                              <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                              <script>
                                const ctx = document.getElementById('myChart');
                              
                                new Chart(ctx, {
                                  type: 'bar',
                                  data: {
                                    labels: ['<18', '18-24', '25-34', '35-44', '45-49', '50-55', '56+'],
                                    datasets: [
                                        {
                                        label: 'Male',
                                        data: [10, 20, 30, 40, 50, 60, 70],
                                        borderColor: '#36A2EB',
                                        backgroundColor: '#9BD0F5',
                                        },
                                        {
                                        label: 'Female',
                                        data: [7, 18, 23, 33, 43, 53, 63],
                                        borderColor: '#FF6384',
                                        backgroundColor: '#FFB1C1',
                                        }
                                    ]
                                    },
                                  options: {
                                    scales: {
                                      y: {
                                        beginAtZero: true
                                      },
                                    }
                                  }
                                });
                              </script>
                        </div>
                      </div>
                    </div>
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="headingTwo">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                          Students whose rating average for Comedy movies is greater than 4
                        </button>
                      </h2>
                      <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                          <strong>This is the second item's accordion body.</strong> It is hidden by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the <code>.accordion-body</code>, though the transition does limit overflow.
                        </div>
                      </div>
                    </div>
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="headingThree">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                            Students in Iowa whose rating average for Adventure movies is greater than 4
                        </button>
                      </h2>
                      <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                          <strong>This is the third item's accordion body.</strong> It is hidden by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the <code>.accordion-body</code>, though the transition does limit overflow.
                        </div>
                      </div>
                    </div>
                    -->

                  </div>
                
                  </div>
            </div>
          </div>
      </div>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js" integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N" crossorigin="anonymous"></script>
  </body>
</html>